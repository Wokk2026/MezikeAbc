---
// M√©zike ABC - √ñtletl√°da 4.0 (√ñr√∂k mem√≥ria, 5 napos limit √©s Szab√°lyok)
const boltNev = "M√©zike ABC";
const cim = "1238 Budapest, Grassalkovich √∫t (A nagy templom m√∂g√∂tt)";
---

<html lang="hu">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>√ñtletl√°da - {boltNev}</title>
		<style>
			:root {
				--ginger-brown: #d2691e;
				--shrek-green: #7dbb42;
				--warm-cream: #fff9f0;
				--deep-brown: #5d3a1a;
                --botanical-bg: #f0f7e9;
                --gold-glow: #ffd700;
			}

            * { -webkit-tap-highlight-color: transparent; outline: none; box-sizing: border-box; }

			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				background: var(--warm-cream); color: var(--deep-brown); margin: 0; overflow-x: hidden;
			}

			.container { max-width: 900px; margin: 0 auto; padding: 0 20px; }
			
			header { 
				background: rgba(255, 255, 255, 0.95); padding: 1rem 0; 
				border-bottom: 4px solid var(--shrek-green); position: sticky; top: 0; z-index: 1000;
			}
			.nav-flex { display: flex; justify-content: space-between; align-items: center; }
            .logo { font-size: 1.5rem; font-weight: bold; color: var(--ginger-brown); text-decoration: none; }
            nav a { margin: 0 10px; text-decoration: none; color: var(--deep-brown); font-weight: 600; }

            .main-content { padding: 4rem 0; text-align: center; }

            /* Bek√ºld≈ë fel√ºlet */
            .choice-container { display: flex; justify-content: center; gap: 20px; margin-bottom: 2rem; }
            .choice-card {
                background: white; padding: 1.5rem; border-radius: 30px; border: 3px solid var(--ginger-brown);
                cursor: pointer; transition: 0.3s; width: 130px;
            }
            .choice-card.active { background: var(--botanical-bg); border-color: var(--shrek-green); }

            #form-section { display: none; margin-bottom: 4rem; }
            #form-section.visible { display: block; }
            textarea {
                width: 100%; max-width: 500px; height: 100px; border-radius: 20px;
                border: 3px solid var(--ginger-brown); padding: 1rem; margin-bottom: 1rem; resize: none;
            }
            .send-btn { background: var(--ginger-brown); color: white; border: none; padding: 12px 30px; border-radius: 50px; cursor: pointer; font-weight: bold; }

            /* --- FAL √âS K√ÅRTY√ÅK --- */
            .wall-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 2rem; text-align: left; }
            .column-title { text-align: center; color: var(--ginger-brown); border-bottom: 3px solid var(--shrek-green); margin-bottom: 20px; }

            .entry-card {
                background: white; padding: 1.5rem; border-radius: 20px; border: 2px solid #ddd;
                margin-bottom: 15px; transition: 0.5s; position: relative;
            }

            /* --- Z√ñLD VIL√ÅG√çT√ÅS (10 LIKE ESET√âN) --- */
            .glowing-green {
                border: 4px solid var(--shrek-green) !important;
                box-shadow: 0 0 20px var(--shrek-green);
                background: #fafff5;
                animation: pulse-green 2s infinite;
            }

            @keyframes pulse-green {
                0% { box-shadow: 0 0 5px var(--shrek-green); }
                50% { box-shadow: 0 0 25px var(--shrek-green); }
                100% { box-shadow: 0 0 5px var(--shrek-green); }
            }

            .vote-bar { display: flex; gap: 15px; align-items: center; border-top: 1px solid #eee; padding-top: 10px; margin-top: 10px; }
            .vote-btn { background: var(--botanical-bg); border: 1px solid #ddd; cursor: pointer; padding: 5px 12px; border-radius: 12px; transition: 0.2s; position: relative; }
            .vote-btn:disabled { opacity: 0.3; cursor: not-allowed; }

            .particle { position: absolute; pointer-events: none; opacity: 0; animation: particle-pop 0.8s forwards; }
            @keyframes particle-pop { 0% { transform: translate(0,0) scale(0); opacity: 1; } 100% { transform: translate(var(--x), var(--y)) scale(1); opacity: 0; } }

            #mailbox-container { position: fixed; bottom: -200px; left: 50%; transform: translateX(-50%); transition: 0.8s; font-size: 5rem; z-index: 2000; }
            #mailbox-container.up { bottom: 20px; }

            @media (max-width: 768px) { .wall-grid { grid-template-columns: 1fr; } }
		</style>
	</head>
	<body>
		<header>
			<div class="container nav-flex">
				<a href="/" class="logo">{boltNev}</a>
                <nav>
                    <a href="/">F≈ëoldal</a>
                    <a href="/akciok">Akci√≥k</a>
                    <a href="/jatek">Kv√≠z</a>
                    <a href="/otletlada">√ñtletl√°da</a>
                </nav>
			</div>
		</header>

		<main class="container main-content">
            <h1>Mocs√°ri √ñtletl√°da</h1>
            <div class="choice-container">
                <div class="choice-card" id="btn-otlet"><span class="icon">üí°</span><strong>√ñtlet</strong></div>
                <div class="choice-card" id="btn-velemeny"><span class="icon">‚≠ê</span><strong>V√©lem√©ny</strong></div>
            </div>

            <div id="form-section">
                <textarea id="message" placeholder="√çrd ide az √ºzeneted..."></textarea><br>
                <button class="send-btn" id="send-btn">Bek√ºld√©s</button>
            </div>

            <div class="wall-grid">
                <div><h3 class="column-title">üí° √ñtletek</h3><div id="otlet-list"></div></div>
                <div><h3 class="column-title">‚≠ê V√©lem√©nyek</h3><div id="velemeny-list"></div></div>
            </div>
		</main>

        <div id="mailbox-container">üìÆ</div>

        <script>
            // --- MEM√ìRIA √âS SZAB√ÅLYOK ---
            const FIVE_DAYS_MS = 5 * 24 * 60 * 60 * 1000;
            
            // Adatok bet√∂lt√©se a b√∂ng√©sz≈ëb≈ël
            let entries = JSON.parse(localStorage.getItem('mocsari_uzenetek') || '[]');
            let votedIds = JSON.parse(localStorage.getItem('voted_posts') || '[]');

            const otletList = document.getElementById('otlet-list');
            const velemenyList = document.getElementById('velemeny-list');
            let currentType = "";

            // Tiszta mocs√°r: T√∂r√∂lj√ºk a 10 dislike-os vagy 5 napn√°l r√©gebbi √ºzeneteket
            function cleanup() {
                const now = Date.now();
                entries = entries.filter(e => {
                    const isTooOld = (now - e.createdAt) > FIVE_DAYS_MS;
                    const isHated = e.dislikes >= 10;
                    return !isTooOld && !isHated;
                });
                save();
            }

            function save() { localStorage.setItem('mocsari_uzenetek', JSON.stringify(entries)); }

            // Interakci√≥k
            document.getElementById('btn-otlet').onclick = () => { currentType = "otlet"; document.getElementById('form-section').classList.add('visible'); };
            document.getElementById('btn-velemeny').onclick = () => { currentType = "velemeny"; document.getElementById('form-section').classList.add('visible'); };

            document.getElementById('send-btn').onclick = () => {
                const text = document.getElementById('message').value;
                if(!text) return;
                
                entries.push({
                    id: Date.now(),
                    type: currentType,
                    text: text,
                    likes: 0,
                    dislikes: 0,
                    createdAt: Date.now()
                });
                
                save();
                const mailbox = document.getElementById('mailbox-container');
                mailbox.classList.add('up');
                setTimeout(() => { mailbox.classList.remove('up'); document.getElementById('message').value = ""; renderWall(); }, 1500);
            };

            function spawnParticles(element, emoji) {
                for (let i = 0; i < 6; i++) {
                    const p = document.createElement('span');
                    p.className = 'particle'; p.innerText = emoji;
                    p.style.setProperty('--x', (Math.random() - 0.5) * 80 + 'px');
                    p.style.setProperty('--y', (Math.random() - 1) * 60 + 'px');
                    element.appendChild(p);
                    setTimeout(() => p.remove(), 800);
                }
            }

            window.handleVote = (btn, id, isLike) => {
                if(votedIds.includes(id)) return;
                const entry = entries.find(e => e.id === id);
                if(!entry) return;

                if(isLike) {
                    entry.likes++;
                    spawnParticles(btn, 'üå∏');
                } else {
                    entry.dislikes++;
                    spawnParticles(btn, 'üò°');
                }

                votedIds.push(id);
                localStorage.setItem('voted_posts', JSON.stringify(votedIds));
                save();
                cleanup(); // Azonnali ellen≈ërz√©s a 10 dislike-ra
                setTimeout(renderWall, 400);
            };

            function renderWall() {
                cleanup();
                otletList.innerHTML = ""; velemenyList.innerHTML = "";
                
                // Rangsor: Akinek t√∂bb a (likes - dislikes) k√ºl√∂nbs√©ge, az van fel√ºl
                const sorted = [...entries].sort((a, b) => (b.likes - b.dislikes) - (a.likes - a.dislikes));

                sorted.forEach(entry => {
                    const hasVoted = votedIds.includes(entry.id);
                    const isGolden = entry.likes >= 10;
                    
                    const card = document.createElement('div');
                    card.className = `entry-card ${isGolden ? 'glowing-green' : ''}`;
                    card.innerHTML = `
                        <div class="entry-text">${entry.text}</div>
                        <div class="vote-bar">
                            <button class="vote-btn" ${hasVoted ? 'disabled' : ''} onclick="handleVote(this, ${entry.id}, true)">
                                üåø <span>${entry.likes}</span>
                            </button>
                            <button class="vote-btn" ${hasVoted ? 'disabled' : ''} onclick="handleVote(this, ${entry.id}, false)">
                                üí© <span>${entry.dislikes}</span>
                            </button>
                        </div>
                    `;
                    if(entry.type === 'otlet') otletList.appendChild(card);
                    else velemenyList.appendChild(card);
                });
            }

            renderWall();
        </script>
	</body>
</html>